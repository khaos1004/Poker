<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="theme-color" content="#000000" />
    <title>TomatoSevenPoker</title>
    <link rel="stylesheet" href="./assets/css/index.css">
</head>

<body onload="init()">

    <!-- <div id="money-box"
        style="position: fixed; top: 50%; left: 50%; color:white; font-size:24px; z-index: 9999; transform: translate(-50%, -50%)">
        <span id="my-money">0</span>
    </div> -->

    <div id=content class="content">

        <!--  -->
        <div id="z-call" style=" position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%); 
        padding: 20px; border-radius: 10px; text-align: center; z-index: 9999;">
            <!-- <div>
        ë‚´ ID
        <u id="my_id"></u><br>
        <hr>
    </div> -->
            <div style="position:absolute; top:200px; left:830.5px; width: 200px;">
                <h2 style="font-size: 24px; color: white; margin-bottom: 10px;">ë°© ì´ë¦„</h2>
            </div>
            <div style="position:absolute; top:260px; left:830px; z-index:99;">
                <input type="text" id="room_id" placeholder="ë°©ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." value="456" />
            </div>

            <div id="room_list_container"
                style="text-align: center; margin: 20px auto; width: 300px; position:absolute; top:290px; left:790.5px; ">
                <h2 style="font-size: 24px; color: white; margin-bottom: 10px;">ëŒ€ê¸°ì¤‘ì¸ ë°©</h2>
                <div id="room_list"
                    style="border: 2px solid #555; border-radius: 8px; background-color: rgba(0, 0, 0, 0.7); color: white; padding: 15px;">
                </div>
                <div style=" width: 300px; margin-top: 10px;">
                    <button id="room_create_btn">ì ‘ì†</button>
                    <button id="room_leave_btn">ë‚˜ê°€ê¸°</button>
                </div>
            </div>
        </div>
        <div id="room_buttons"
            style="display: none; position: absolute; top:500px; left:900px; z-index: 9999; width: 300px;">
            <button id="room_leave_btn_main" style="padding: 20px 30px; font-size: 16px; border-radius: 8px; background-color: #ff4d4d; color: white; 
               border: none; cursor: pointer; box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3); ">
                ë°© ë‚˜ê°€ê¸°
            </button>
        </div>
        <!--  -->
        <div id="dark"
            style="background-color: black; width:1920px; height:1080px; z-index: 98; position:absolute; top:0px; left:0px; opacity: 0.7; display: none;">
        </div>
        <div id="gameover" style="z-index:99; position:absolute; display: none;">
            <!-- <p style="text-align: center; color:white; width:1920px; font-size: 40px;" id="winner-info">ë‹˜ì´ ì´ê²¼ìŠµë‹ˆë‹¤.</p> -->
            <p style="text-align: center; color:white; width:1920px; font-size: 100px;" id="winner-result">WIN</p>
            <button onclick="restart()"
                style="position:absolute; left:710px; top:400px; font-size: 40px; width:500px; height:150px; border-radius: 40px; background-color: #c92800; color:white;">ë‹¤ì‹œí•˜ê¸°</button>
        </div>
        <div id="choice-box" style="z-index:99; position:absolute; display: none;">
            <p style="text-align: center; color:white; width:1920px; font-size: 50px;">ì˜¤í”ˆì¹´ë“œ í•œì¥ê³¼ ë²„ë¦´ì¹´ë“œ í•œì¥ì„ ê³¨ë¼ì£¼ì„¸ìš”.</p>
            <div style="width:240px; height:360px; background-color: white; position: absolute;
                border-radius: 10px; top:360px; left:380px; border:5px solid #dedede;" id="c-1"
                onclick="choiceSelect(1)">
                <div id="c-n-1" style="font-size:70px; font-weight: bold; position: absolute; left:10px;">10</div>
                <div id="c-s-1" style="font-size:180px;left:30px;position:absolute;top:40px;">â™£</div>
            </div>
            <div style="width:240px; height:360px; background-color: white; position: absolute;
                border-radius: 10px; top:360px; left:680px; border:5px solid #dedede;" id="c-2"
                onclick="choiceSelect(2)">
                <div id="c-n-2" style="font-size:70px; font-weight: bold; position: absolute; left:10px;">10</div>
                <div id="c-s-2" style="font-size:180px;left:30px;position:absolute;top:40px;">â™£</div>
            </div>
            <div style="width:240px; height:360px; background-color: white; position: absolute;
                border-radius: 10px; top:360px; left:980px; border:5px solid #dedede;" id="c-3"
                onclick="choiceSelect(3)">
                <div id="c-n-3" style="font-size:70px; font-weight: bold; position: absolute; left:10px;">10</div>
                <div id="c-s-3" style="font-size:180px;left:30px;position:absolute;top:40px;">â™£</div>
            </div>
            <div style="width:240px; height:360px; background-color: white; position: absolute;
                border-radius: 10px; top:360px; left:1280px; border:5px solid #dedede;" id="c-4"
                onclick="choiceSelect(4)">
                <div id="c-n-4" style="font-size:70px; font-weight: bold; position: absolute; left:10px;">10</div>
                <div id="c-s-4" style="font-size:180px;left:30px;position:absolute;top:40px;">â™£</div>
            </div>
            <p style="text-align: center; color:white; width:1920px; font-size: 50px;" id="c-info">ì˜¤í”ˆì¹´ë“œ : / ë²„ë¦´ì¹´ë“œ : </p>
            <button onclick="choiceSend()"
                style="position:absolute; left:710px; top:800px; font-size: 40px; width:500px; height:150px; border-radius: 40px; background-color: #006d40; color:white;">ì„ íƒì™„ë£Œ</button>
        </div>
        <div id="choice-box-waiting" style="z-index:99; position:absolute; display: none;">
            <p style="text-align: center; color:white; width:1920px; font-size: 50px;">ë‹¤ë¥¸ í”Œë ˆì´ì–´ ì„ íƒì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘ì…ë‹ˆë‹¤.</p>
        </div>

        <img src="./assets/img/back.png" class="backimg">


        <div style="width:600px; height:250px; background-color: black; position: absolute;
            top:100px; left:50px; opacity: 0.4; border-radius: 10px;" class="space" id="space1">
        </div>
        <div style="position:absolute; top:5px; left:20px; width:50px; height:50px; text-align:center; border-radius: 50px; color:rgb(212, 0, 0); background-color: rgb(224, 181, 181); font-size: 40px; display: none;"
            id="user1-boss">B</div>
        <div style="position:absolute; top:40px; left:50px; width:600px; color:white; font-size: 40px; opacity: 0.4;"
            id="user1-text"></div>
        <div style="position:absolute; top:40px; left:50px; width:600px; color:rgb(238, 255, 0); text-align: right; font-size: 40px; opacity: 1; font-weight: bold;"
            id="user1-bet"></div>

        <div style="width:600px; height:250px; background-color: black; position: absolute;
            top:450px; left:50px; opacity: 0.4; border-radius: 10px;" class="space" id="space2">
        </div>
        <div style="position:absolute; top:355px; left:20px; width:50px; height:50px; text-align:center; border-radius: 50px; color:rgb(212, 0, 0); background-color: rgb(224, 181, 181); font-size: 40px; display: none; "
            id="user2-boss">B</div>
        <div style="position:absolute; top:390px; left:50px; width:600px; color:white; font-size: 40px; opacity: 0.4;"
            id="user2-text"></div>
        <div style="position:absolute; top:390px; left:50px; width:600px; color:rgb(238, 255, 0); text-align: right; font-size: 40px; opacity: 1; font-weight: bold;"
            id="user2-bet"></div>

        <div style="width:600px; height:250px; background-color: black; position: absolute;
            top:100px; left:1271px; opacity: 0.4; border-radius: 10px;" class="space" id="space3">
        </div>
        <div style="position:absolute; top:5px; left:1241px; width:50px; height:50px; text-align:center; border-radius: 50px; color:rgb(212, 0, 0); background-color: rgb(224, 181, 181); font-size: 40px; display: none;"
            id="user3-boss">B</div>
        <div style="position:absolute; top:40px; left:1271px; width:600px; color:white; font-size: 40px; opacity: 0.4;"
            id="user3-text"></div>
        <div style="position:absolute; top:40px; left:1271px; width:600px; color:rgb(238, 255, 0); text-align: right; font-size: 40px; opacity: 1; font-weight: bold;"
            id="user3-bet"></div>

        <div style="width:600px; height:250px; background-color: black; position: absolute;
            top:450px; left:1271px; opacity: 0.4; border-radius: 10px;" class="space" id="space3">
        </div>
        <div style="position:absolute; top:355px; left:1241px; width:50px; height:50px; text-align:center; border-radius: 50px; color:rgb(212, 0, 0); background-color: rgb(224, 181, 181); font-size: 40px; display: none;"
            id="user4-boss">B</div>
        <div style="position:absolute; top:390px; left:1271px; width:600px; color:white; font-size: 40px; opacity: 0.4;"
            id="user4-text"></div>
        <div style="position:absolute; top:390px; left:1271px; width:600px; color:rgb(238, 255, 0); text-align: right; font-size: 40px; opacity: 1; font-weight: bold;"
            id="user4-bet"></div>

        <div style="width:700px; height:300px; background-color: black; position: absolute;
            top:750px; left:610.5px; opacity: 0.4; border-radius: 10px;" class="space" id="space3">
        </div>
        <div style="position:absolute; top:690px; left:555px; width:50px; height:50px; text-align:center; border-radius: 50px; color:rgb(212, 0, 0); background-color: rgb(224, 181, 181); font-size: 40px; display: none;"
            id="my-boss">B</div>
        <div style="position: absolute; top: 690px; left: 610.5px; width: 700px; color: white; font-size: 47px; 
            opacity: 0.4; text-align: center; line-height: 1.5;" id="myid-text">
        </div>
        <div id="money-box "
            style="color:white; font-size:24px; position: absolute; top: 700px; left: 1050px; width: 700px; font-size: 40px; opacity: 0.4;">
            <span id="my-money">0</span>
        </div>
        <div style="position:absolute; top:690px; left:610.5px; width:700px; color:rgb(238, 255, 0); text-align: right; font-size: 40px; opacity: 1; font-weight: bold;"
            id="myid-bet"></div>




        <div style="width:120px; height:180px; background-color: gray; position: absolute;
                border-radius: 10px; top:-60px; left:840.5px; border:5px solid #dedede;"></div>
        <div style="width:120px; height:180px; background-color: gray; position: absolute;
            border-radius: 10px; top:-70px; left:850.5px; border:5px solid #dedede;"></div>
        <div style="width:120px; height:180px; background-color: gray; position: absolute;
            border-radius: 10px; top:-80px; left:830.5px; border:5px solid #dedede;"></div>
        <div id="test" style="width:120px; height:180px; background-color: gray; position: absolute;
            border-radius: 10px; top:-90px; left:850.5px; border:5px solid #dedede;"></div>

        <div style="width:1921px; height:100px; background-color: black; position: absolute;
            top:-100px; left:0px; z-index: 10;"></div>



        <img id="game_start_btn" src="/assets/img/start.png" width="500"
            style="position:absolute; top:300px; left:710.5px; display: none; z-index:99; ">


        <div id="pot-box" style="display:none;">
            <div style="width:400px; height:150px; position:absolute; top:400px; left:752.5px; 
                border-radius: 20px; border: 3px solid rgb(216, 216, 130); font-size: 30px;color:rgb(216, 216, 130);
                font-weight: bold; line-height: 20px; background-color: black; opacity: 0.5;">
                <br>&nbsp;&nbsp;POT&nbsp;&nbsp;&nbsp;<br><br><br><br>&nbsp;&nbsp;<div
                    style="display:inline-block; color:white;">CALL</div>&nbsp;&nbsp;&nbsp;
            </div>

            <div style="width:380px; height:150px; position:absolute; top:360px; left:752.5px; 
                border-radius: 20px;font-size: 40px;color:rgb(216, 216, 130); 
                font-weight: bold; line-height: 150px; text-align: right; padding-right: 20px;" id="pot">0</div>
            <div style="width:380px; height:150px; position:absolute; top:440px; left:752.5px; 
                border-radius: 20px;font-size: 40px;color:white;
                font-weight: bold; line-height: 150px; text-align: right; padding-right: 20px;" id="mycall">0</div>
        </div>


        <div id="user1-area"></div>
        <div id="user2-area"></div>
        <div id="user3-area"></div>
        <div id="user4-area"></div>

        <div id="mycard-area">
        </div>


        <div style="width:500px; height:300px; position:absolute; top:750px; left:50px;
            background-color: black; opacity:0.5 ; border-radius: 10px; font-size: 30px; color:white;
            padding-left: 30px;">
        </div>
        <div style="width:500px; height:300px; position:absolute; top:750px; left:50px;
            border-radius: 10px; font-size: 30px; color:white;
            padding-left: 30px;padding-top: 10px;" id="mylevel-box">
        </div>


        <div style="width:500px; height:300px; position:absolute; top:750px; left:1370px;border-radius: 10px; color:white;"
            id="betting_box">
            <div style="width:200px; height:100px; background-color: #a33b0a; color:white; border-radius: 20px;
                font-size: 50px;line-height: 100px; text-align: center; display: inline-block;"
                onclick="betting('double')" id="btn6">ë”°ë‹¹</div>
            <div style="width:200px; height:100px; background-color: #96023f; color:white; border-radius: 20px;
                font-size: 50px;line-height: 100px; text-align: center; display: inline-block;"
                onclick="betting('bing')" id="btn5">ì‚¥</div>
            <div style="width:200px; height:100px; background-color: #880000; color:white; border-radius: 20px;
                font-size: 50px;line-height: 100px; text-align: center; display: inline-block;"
                onclick="betting('quater')" id="btn3">ì¿¼í„°</div>
            <div style="width:200px; height:100px; background-color: #ffffff; color:black; border-radius: 20px;
                font-size: 50px;line-height: 100px; text-align: center; display: inline-block;"
                onclick="betting('call')" id="btn1">ì½œ</div>
            <div style="width:200px; height:100px; background-color: #000000; color:white; border-radius: 20px;
                font-size: 50px;line-height: 100px; text-align: center; display: inline-block;"
                onclick="betting('half')" id="btn2">í•˜í”„</div>
            <div style="width:200px; height:100px; background-color: #4d3e00; color:white; border-radius: 20px;
                font-size: 50px;line-height: 100px; text-align: center; display: inline-block;"
                onclick="betting('die')" id="btn4">ë‹¤ì´</div>

        </div>
    </div>

    <script src="/assets/js/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        //game info
        let userList;
        let myId;
        let choiceRemoveId = -1;
        let choiceOpenId = -1;
        let choiceCards;
        let myMoney = 100000000;
        let currentId = '';
        let oname = "";
        let rname = "";


        function choiceSelect(idx) {
            if (choiceOpenId == -1 || choiceRemoveId != -1) {
                choiceOpenId = idx - 1;
                choiceRemoveId = -1;
                oname = getCardName(choiceCards[choiceOpenId]);
                rname = "";
            } else if (choiceOpenId != -1 && choiceRemoveId == -1) {
                choiceRemoveId = idx - 1;
                rname = getCardName(choiceCards[choiceRemoveId]);
            }
            let info = `ì˜¤í”ˆì¹´ë“œ : ${oname} / ë²„ë¦´ì¹´ë“œ : ${rname}`;
            $('#c-info').html(info);
        }

        function choiceSel(idx) {
            choiceOpenId = idx;
            console.log("choice sel = " + idx);
            $('#choiceResult').html(`sel ${choiceOpenId} / remove ${choiceRemoveId}`);
        }

        function choiceRemove(idx) {
            choiceRemoveId = idx;
            console.log("choice remove = " + idx);
            $('#choiceResult').html(`sel ${choiceOpenId} / remove ${choiceRemoveId}`);
        }

        function getLevelText(level) {
            if (level == 12) {
                return "íƒ‘";
            } else if (level == 11) {
                return "ì›í˜ì–´";
            }
            else if (level == 10) {
                return "íˆ¬í˜ì–´";
            }
            else if (level == 9) {
                return "íŠ¸ë¦¬í”Œ";
            }
            else if (level == 8) {
                return "ìŠ¤íŠ¸ë ˆì´íŠ¸";
            }
            else if (level == 7) {
                return "ë°±ìŠ¤íŠ¸ë ˆì´íŠ¸";
            }
            else if (level == 6) {
                return "ë§ˆìš´í‹´";
            }
            else if (level == 5) {
                return "í”ŒëŸ¬ì‰¬";
            }
            else if (level == 4) {
                return "í’€í•˜ìš°ìŠ¤";
            }
            else if (level == 3) {
                return "í¬ì¹´ë“œ";
            }
            else if (level == 2) {
                return "ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‰¬";
            }
            else if (level == 1) {
                return "ë¡œì—´ ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‰¬";
            }

        }

        function getShape(shape) {
            if (shape == "S") {
                return "â™ ";
            } else if (shape == "D") {
                return "â—†"
            } else if (shape == "H") {
                return "â™¥"
            } else if (shape == "C") {
                return "â™£"
            }
        }

        function getNumber(num) {
            if (num == 1) {
                return "A";
            } else if (num == "11") {
                return "J";
            } else if (num == "12") {
                return "Q";
            } else if (num == "13") {
                return "K";
            } else {
                return num;
            }
        }

        function getCardName(card) {
            let s = "";
            let n = "";
            if (card.shape == "S") {
                s = "â™ ";
            } else if (card.shape == "D") {
                s = "â—†"
            } else if (card.shape == "H") {
                s = "â™¥"
            } else if (card.shape == "C") {
                s = "â™£"
            }
            if (card.number == 1) {
                n = "A";
            } else if (card.number == "11") {
                n = "J";
            } else if (card.number == "12") {
                n = "Q";
            } else if (card.number == "13") {
                n = "K";
            } else {
                n = String(card.number);
            }
            if (card.isShow) {
                return s + n;
            }
            return `[${s + n}]`;
        }

        function displayMyCard(cards) {
            let cnt = 0;
            if (cards.length <= 4) {
                for (var c of cards) {
                    flyMyCard(cnt, c.shape, c.number, c.isShow);
                    ++cnt;
                }
            } else {
                let lastIdx = cards.length - 1;
                let c = cards[lastIdx];
                flyMyCard(lastIdx, c.shape, c.number, c.isShow);
            }
        }

        function displayUserCard(cards) {

            var idx = 0;
            for (var u of userList) {
                if (u === myId) {
                    continue;
                }
                idx += 1;
                if (cards[u].length <= 2) {
                    let cnt = 2;
                    flyUserCard(idx, 0, '', 0, false);
                    flyUserCard(idx, 1, '', 0, false);
                    for (var c of cards[u]) {
                        flyUserCard(idx, cnt, c.shape, c.number, c.isShow);
                        cnt += 1;
                    }
                } else {
                    let lastIdx = cards[u].length - 1;
                    let c = cards[u][lastIdx];
                    flyUserCard(idx, lastIdx + 2, c.shape, c.number, c.isShow);
                }
            }
        }

        function updateUserInfo() {

            for (var i = 1; i <= 4; i++) {
                $(`#user${i}-text`).html("");
            }

            let cnt = 0;
            for (var u of userList) {
                if (u.id == myId) {
                    continue;
                }
                ++cnt;
                $(`#user${cnt}-text`).html(u.name + "ë‹˜");
            }
        }



    </script>
    <script>
        var socket = io();
        var joinRoomId = null;

        socket.on('welcome', ({ id, money }) => {
            myId = id;
            $('#my_id').html(id);
            $('#myid-text').html(playerName + "");
            $('#my-money').html(`${money}ëƒ¥`);
        });

        socket.on("room_join", ({ result, error }) => {
            console.log("ë°© ì…ì¥ ì´ë²¤íŠ¸ ë°œìƒ");
            if (result === "success") {
                console.log("ë‚˜ê°€ê¸° ë²„íŠ¼ í‘œì‹œ");
                document.getElementById("room_buttons").style.display = "block"; // ë‚˜ê°€ê¸° ë²„íŠ¼ í‘œì‹œ
            } else if (error) {
                console.log("ë°© ì…ì¥ ì‹¤íŒ¨: " + error);
            }
        });

        // ë°© í‡´ì¥ ì‹œ ë‚˜ê°€ê¸° ë²„íŠ¼ ìˆ¨ê¹€
        socket.on("room_leave", ({ result }) => {
            if (result === "success") {
                console.log("ë°©ì—ì„œ ë‚˜ê°");
                joinRoomId = null;
                document.getElementById("room_buttons").style.display = "none"; // ë‚˜ê°€ê¸° ë²„íŠ¼ ìˆ¨ê¹€
                alert("ë°©ì—ì„œ ë‚˜ì™”ìŠµë‹ˆë‹¤.");
                window.location.reload();
            }
        });

        socket.on('user_info', ({ users, hostId, result }) => {
            let isJoin = false;
            if (users.length > 0) {
                $('#dark').css('display', 'block');

                // ë°©ì¥ í™•ì¸ í›„ ê²Œì„ ì‹œì‘ ë²„íŠ¼ í‘œì‹œ (ì´ë¯¸ì§€ ë°©ì‹)
                if (users[0].id === myId) {
                    $("#game_start_btn").css('display', 'inline-block');
                    console.log("ë°©ì¥ì…ë‹ˆë‹¤. ê²Œì„ ì‹œì‘ ë²„íŠ¼ í‘œì‹œë¨.");
                } else {
                    $("#game_start_btn").css('display', 'none');
                }
            } else {
                $("#game_start_btn").css('display', 'none'); // ì•„ë¬´ë„ ì—†ìœ¼ë©´ ë²„íŠ¼ ìˆ¨ê¹€
            }

            for (var user of users) {
                if (user.id === myId) {
                    isJoin = true;
                    break;
                }
            }

            if (isJoin) {
                userList = users;

                // `[object Object]ë‹˜` ë¬¸ì œ í•´ê²° (user.nameì„ ì‚¬ìš©)
                let userListHtml = users.map(user => user.name == playerName ? `${user.name}ë‹˜` : 'ì•Œ ìˆ˜ ì—†ìŒ').join('<br>');
                $("#users").html(userListHtml);

                console.log("í˜„ì¬ ë°© ì°¸ê°€ì ëª©ë¡: ", users);
            } else {
                userList = [];
                $("#users").html("");
            }

            updateUserInfo(); // ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€
        });

        //choice
        socket.on("choice", ({ cards }) => {
            //init();
            rname = "";
            oname = "";

            initText();
            $('#gameover').css('display', 'none');
            $('#game_start_btn').css('display', 'none');
            $('#pot-box').css('display', 'block');
            $('#dark').css('display', 'block');
            $('#choice-box').css('display', 'block');

            console.log("choice cards ");
            console.log(cards);
            choiceCards = cards;

            for (var i = 0; i < cards.length; i++) {
                let idx = i + 1;
                $(`#c-n-${idx}`).html(getNumber(cards[i].number));
                $(`#c-s-${idx}`).html(getShape(cards[i].shape));
                if (cards[i].shape == 'H' || cards[i].shape == 'D') {
                    $(`#c-n-${idx}`).css('color', 'red');
                    $(`#c-s-${idx}`).css('color', 'red');
                } else {
                    $(`#c-n-${idx}`).css('color', 'black');
                    $(`#c-s-${idx}`).css('color', 'black');
                }

            }

        });

        //give
        socket.on('give_my_card_info', ({ cards, level }) => {
            $('#choice-box-waiting').css('display', 'none');
            $('#dark').css('display', 'none');
            console.log("my level : " + level);

            $('#mylevel-box').html("");

            let dek = ["", "ë¡œì—´ ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‰¬", "ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‰¬", "í¬ì¹´ë“œ", "í’€í•˜ìš°ìŠ¤", "í”ŒëŸ¬ì‰¬",
                "ë§ˆìš´í‹´", "ë°±ìŠ¤íŠ¸ë ˆì´íŠ¸", "ìŠ¤íŠ¸ë ˆì´íŠ¸", "íŠ¸ë¦¬í”Œ", "íˆ¬í˜ì–´", "ì›í˜ì–´", "íƒ‘"];
            let start = 0;
            let end = 0;
            if (level > 9) {
                end = 12;
                start = 7;
            } else if (level < 4) {
                start = 1;
                end = 6;
            } else {
                end = level + 3;
                start = level - 2;
            }

            let levelText = "";
            for (var i = start; i <= end; i++) {
                if (level == i) {
                    levelText = `<div style="display:inline-block; color:rgb(96, 209, 96);font-weight: bold;">${dek[i]}</div><br>`;
                } else {
                    levelText = `<div style="display:inline-block; color:white;">${dek[i]}</div><br>`;
                }
                $('#mylevel-box').append(levelText);
            }

            console.log('give_my_card_info');
            console.log(cards);
            displayMyCard(cards);

        });

        socket.on('give_user_card_info', ({ cards }) => {

            console.log('give_user_card_info');
            console.log(cards);
            displayUserCard(cards);

        });



        //boss
        socket.on('boss', ({ bossId }) => {

            $(`#my-boss`).css('display', 'none');
            $(`#user1-boss`).css('display', 'none');
            $(`#user2-boss`).css('display', 'none');
            $(`#user3-boss`).css('display', 'none');
            $(`#user4-boss`).css('display', 'none');

            console.log("boss id is " + bossId);
            currentId = bossId;
            if (bossId == myId) {
                $(`#my-boss`).css('display', 'block');
            } else {
                let cnt = 1;
                for (var u of userList) {
                    if (u == myId) {
                        continue;
                    }
                    if (u == bossId) {
                        $(`#user${cnt}-boss`).css('display', 'block');
                        break;
                    }
                    cnt += 1;
                }
            }

        });

        socket.on('bettingInfo', ({ currentUserId, userId, userList, pot, maxCall, callList, betPrice, turn, hasBetCnt, type }) => {

            console.log('=========');
            console.log(`currentUserId ${currentUserId}  userId ${userId}`);
            console.log(`pot ${pot}  maxCall ${maxCall}  betPrice ${betPrice}`);
            console.log('=========');
            console.log(callList);
            let myCall = parseInt(maxCall) - callList[myId];
            console.log('mycall = ' + myCall);
            $('#mycall').html(myCall);
            $('#pot').html(pot);
            //$('#betting_box').css('display', 'none');
            $('#turn').html(turn);
            if (currentUserId != null) {
                //$('#currentUserId').html(currentUserId);
                currentId = currentUserId;
                highlightCurrentUser(currentUserId);
                if (currentUserId == myId) {
                    $('#betting_box').css('opacity', '1');
                    if (hasBetCnt) {
                        for (var i = 1; i <= 6; i++) {
                            $('#btn' + i).css('display', 'inline-block');
                        }
                    } else {
                        for (var i = 1; i <= 6; i++) {
                            $('#btn' + i).css('display', 'none');
                        }
                        $('#btn1').css('display', 'inline-block');
                        $('#btn4').css('display', 'inline-block');
                    }
                } else {
                    $('#betting_box').css('opacity', '0.5');
                }
                return;
            }

            $('#bet_user_id').html(userId);
            $('#bet_price').html(betPrice);
            if (userId == myId) {
                $('#myid-bet').html(`${type} ${betPrice}`);
                $('#myid-bet').fadeIn("slow").fadeOut("slow");
            } else {
                let cnt = 1;
                for (var u of userList) {
                    if (u == myId) {
                        continue;
                    }
                    if (userId == u) {
                        console.log(cnt);
                        $(`#user${cnt}-bet`).html(`${type} ${betPrice}`);
                        $(`#user${cnt}-bet`).fadeIn("slow").fadeOut("slow");
                        break;
                    }
                    cnt += 1;
                }
            }
        });

        socket.on('betting', ({ userId, type }) => {

            console.log(`userId ${userId}   type ${type}`);

        });


        socket.on('gameover', ({ userList, userCard, winner }) => {
            // $('#winner-info').html(`${name}ë‹˜ì´ ì´ê²¼ìŠµë‹ˆë‹¤.`);
            if (winner == myId) {
                $('#winner-result').css('color', 'white');
                $('#winner-result').html("ğŸ‰WINğŸˆğŸ‘");
            } else {
                $('#winner-result').css('color', 'white');
                $('#winner-result').html("ğŸ¥¶LOSEğŸ˜­");
            }
            console.log('winner is ' + winner);
            console.log(userCard);
            $('#winner').html(winner);

            let cnt = 1;
            for (var u of userList) {
                if (u == myId) {
                    continue;
                }
                var cards = userCard[u];
                let idx = 0;
                for (var c of cards) {
                    updateUserCard(cnt, idx, c.shape, c.number);
                    idx += 1;
                }
                cnt += 1;
            }
            $('#dark').css('display', 'block');
            $('#gameover').css('display', 'block');
        });

    </script>
    <script>
        $("#room_create_btn").click(() => {
            if (joinRoomId != null) {
                alert('ERROR : already join room is ' + joinRoomId);
                return;
            }
            const roomId = $('#room_id').val();
            console.log("ENTERED ROOM ID : " + roomId);
            joinRoomId = roomId;

            // z-indexë¥¼ ë‚®ì¶¤ (IDë‚˜ í´ë˜ìŠ¤ ì´ë¦„ ì‚¬ìš©)
            $("#z-call").css('display', 'none');  // ìš”ì†Œì˜ ID ì‚¬ìš©

            socket.emit("room_join", {
                id: roomId
            });
        });

        $('#room_leave_btn').click(() => {
            if (joinRoomId == null) {
                alert('ì…ì¥ ì¤‘ì¸ ë°©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            socket.emit("room_leave", {
                id: joinRoomId
            });

            joinRoomId = null;

            // í™”ë©´ ì´ˆê¸°í™”
            $("#z-call").css('display', 'block');  // ë©”ì¸ í™”ë©´ í‘œì‹œ
            $("#room_buttons").css('display', 'none'); // ë‚˜ê°€ê¸° ë²„íŠ¼ ìˆ¨ê¹€
        });

        // ë°©ì¥ì´ ê²Œì„ ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‹¤í–‰ë¨
        $("#game_start_btn").click(() => {
            if (myId != null && userList != null && userList.length > 1) {
                socket.emit("game_start", { id: joinRoomId }); // ì„œë²„ë¡œ ê²Œì„ ì‹œì‘ ì´ë²¤íŠ¸ ì „ì†¡
            } else {
                alert("ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìµœì†Œ 2ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            }
        });

        // ì„œë²„ì—ì„œ ëª¨ë“  í”Œë ˆì´ì–´ì—ê²Œ ê²Œì„ ì‹œì‘ ì´ë²¤íŠ¸ë¥¼ ë³´ë‚´ë©´ ì‹¤í–‰ë¨
        socket.on("game_start", () => {
            console.log("ê²Œì„ì´ ë‹¤ì‹œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!");

            // UI ë¦¬ì…‹
            $('#gameover').css('display', 'none');
            $('#pot-box').css('display', 'block');
            $('#dark').css('display', 'block');
            $('#game_start_btn').css('display', 'none');
            $('#my-money').html(`ë³´ìœ  ê¸ˆì•¡: ${userMoney[myId]}ëƒ¥`);

            initText();
        });


        // ë°©ì¥ì´ ê²Œì„ì„ ì‹œì‘í•˜ë©´ ëª¨ë“  í”Œë ˆì´ì–´ì˜ ë‚˜ê°€ê¸° ë²„íŠ¼ì„ ë¹„í™œì„±í™”
        socket.on("disable_exit_button", () => {
            console.log("ë‚˜ê°€ê¸° ë²„íŠ¼ ë¹„í™œì„±í™”ë¨");
            document.getElementById("room_buttons").style.display = "none";
            document.getElementById("room_leave_btn").style.display = "none";
            document.getElementById("room_leave_btn_main").style.display = "none";
        });


        $("#init").click(() => {
            //init();   
        });

        function choiceSend() {

            $("#choice-box").css('display', 'none');
            $("#choice-box-waiting").css('display', 'block');

            let cards = [];
            for (var i = 0; i < choiceCards.length; i++) {
                if (i == choiceRemoveId) {
                    continue;
                }
                if (i == choiceOpenId) {
                    choiceCards[i].isShow = true;
                }
                cards.push(choiceCards[i]);
            }
            console.log(cards);
            socket.emit("choice", {
                cards: cards
            });

        }

        function betting(type) {
            if (currentId != myId) {
                console.log('not my turn.');
                return;
            }
            socket.emit('betting', {
                userId: myId,
                type: type
            });
        }

    </script>

    <script>

        function init() {
            updateResolution();
            console.log('poker game init complete');
        }

        function updateResolution() {
            var rw = window.innerWidth / 1921;
            var rh = window.innerHeight / 1081;
            var r = rw;
            if (rh < rw) {
                r = rh;
            }
            console.log(rw + ", " + rh);
            var gw = (window.innerWidth - (1921 * r)) / 2;
            var gh = (window.innerHeight - (1081 * r)) / 2;
            $('body').css('margin-left', gw);
            $('body').css('margin-top', gh);
            $('#content').css('transform', `scale(${r.toFixed(4)},${r.toFixed(4)})`);
            console.log('updateResolution');
        }

        window.onresize = () => init();

    </script>
    <script>
        function give() {
            $("#test").css('z-index', '9');
            $("#test").animate({
                top: '20px',
                left: '30px'
            })
        }

        function flyMyCard(num, shape, number, isShow) {
            let id = `card-my-${num}`;
            let startTop = '-90px';
            let startLeft = '850.5px';
            let endTop = '770px';
            let endLeftValue = 640 + 70 * num;
            let endLeft = endLeftValue + 'px';
            let card = `<div id="${id}" style="width:140px; height:220px; background-color: gray; position: absolute;
            border-radius: 10px; top:${startTop}; left:${startLeft}; border:5px solid #dedede;">
              <div style="font-size:40px; font-weight: bold; position: absolute; left:10px;color: #bd2828;" id="card-my-number-${num}"></div>
              <div style="font-size:90px;left:25px;position:absolute;top:40px;color:#bd2828;" id="card-my-shape-${num}"></div>
            </div>`;
            $('#mycard-area').append(card);
            $('#' + id).animate({
                top: endTop,
                left: endLeft
            });
            $("#card-my-shape-" + num).html(getShape(shape));
            $("#card-my-number-" + num).html(getNumber(number));
            if (shape == 'H' || shape == 'D') {
                $("#card-my-shape-" + num).css('color', '#bd2828');
                $("#card-my-number-" + num).css('color', '#bd2828');
            } else {
                $("#card-my-shape-" + num).css('color', 'black');
                $("#card-my-number-" + num).css('color', 'black');
            }

            if (isShow) {
                $('#' + id).css('background-color', 'white');
            } else {
                $('#' + id).css('background-color', 'gray');
            }

        }

        function flyUserCard(userId, num, shape, number, isShow) {
            //top:120px; left:70px;
            let id = `card-user${userId}-${num}`;
            let startTop = '-90px';
            let startLeft = '850.5px';
            let endTop = '120px';
            if (userId == 2 || userId == 4) {
                endTop = '470px';
            }
            let endLeftValue = 70 + 70 * num;
            //1291
            if (userId == 3 || userId == 4) {
                endLeftValue = 1291 + 70 * num;
            }
            let endLeft = endLeftValue + 'px';

            let card = `<div id="${id}" style="width:120px; height:180px; background-color: #dedede; position: absolute; top:0px; left:0px;
                    border-radius: 10px; top:${startTop}; left:${startLeft}; border:5px solid #232323;">
                    <div style="font-size:40px; font-weight: bold; position: absolute; left:10px;" id="card-user${userId}-number-${num}"></div>
                    <div style="font-size:70px;left:25px;position:absolute;top:40px;" id="card-user${userId}-shape-${num}"></div>
                </div>`;

            $(`#user${userId}-area`).append(card);
            $('#' + id).animate({
                top: endTop,
                left: endLeft
            });
            if (num > 1 && num != 6) {
                $(`#card-user${userId}-shape-` + num).html(getShape(shape));
                $(`#card-user${userId}-number-` + num).html(getNumber(number));
                if (shape == 'H' || shape == 'D') {
                    $(`#card-user${userId}-shape-` + num).css('color', '#bd2828');
                    $(`#card-user${userId}-number-` + num).css('color', '#bd2828');
                } else {
                    $(`#card-user${userId}-shape-` + num).css('color', 'black');
                    $(`#card-user${userId}-number-` + num).css('color', 'black');
                }

                if (isShow) {
                    $('#' + id).css('background-color', 'white');
                } else {
                    $('#' + id).css('background-color', 'gray');
                }
            } else {
                $('#' + id).css('background-color', 'gray');
            }
        }

        function updateUserCard(userId, num, shape, number) {
            console.log(`${userId} ${num}, ${shape}, ${number}`);
            let id = `card-user${userId}-${num}`;

            $(`#card-user${userId}-shape-` + num).html(getShape(shape));
            $(`#card-user${userId}-number-` + num).html(getNumber(number));
            if (shape == 'H' || shape == 'D') {
                $(`#card-user${userId}-shape-` + num).css('color', '#bd2828');
                $(`#card-user${userId}-number-` + num).css('color', '#bd2828');
            } else {
                $(`#card-user${userId}-shape-` + num).css('color', 'black');
                $(`#card-user${userId}-number-` + num).css('color', 'black');
            }
            $('#' + id).css('background-color', 'white');

        }

        function highlightCurrentUser(userId) {
            $('#mycard-area').css('opacity', '0.5');
            $(`#user1-area`).css('opacity', '0.5');
            $(`#user2-area`).css('opacity', '0.5');
            $(`#user3-area`).css('opacity', '0.5');
            $(`#user4-area`).css('opacity', '0.5');

            $('#myid-text').css('opacity', '0.4');
            $(`#user1-text`).css('opacity', '0.4');
            $(`#user2-text`).css('opacity', '0.4');
            $(`#user3-text`).css('opacity', '0.4');
            $(`#user4-text`).css('opacity', '0.4');


            if (userId == myId) {
                $('#mycard-area').css('opacity', '1');
                $('#myid-text').css('opacity', '1');
            } else {
                let cnt = 1;
                for (var u of userList) {
                    if (u == myId) {
                        continue;
                    }
                    if (u == userId) {
                        $(`#user${cnt}-area`).css('opacity', '1');
                        $(`#user${cnt}-text`).css('opacity', '1');
                        break;
                    }
                    cnt += 1;
                }
            }


        }

        function initText() {
            $('#mycard-area').html("");
            $(`#user1-area`).html("");
            $(`#user2-area`).html("");
            $(`#user3-area`).html("");
            $(`#user4-area`).html("");
            $('#mycall').html("0");
            $('#pot').html("0");

            $('#mycard-area').css('opacity', '0.5');
            $(`#user1-area`).css('opacity', '0.5');
            $(`#user2-area`).css('opacity', '0.5');
            $(`#user3-area`).css('opacity', '0.5');
            $(`#user4-area`).css('opacity', '0.5');

            $('#myid-text').css('opacity', '0.4');
            $(`#user1-text`).css('opacity', '0.4');
            $(`#user2-text`).css('opacity', '0.4');
            $(`#user3-text`).css('opacity', '0.4');
            $(`#user4-text`).css('opacity', '0.4');
        }

        function restart() {
            console.log("ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ í´ë¦­ë¨, ì„œë²„ë¡œ game_restart ì´ë²¤íŠ¸ ì „ì†¡");

            $('#gameover').css('display', 'none');  // ê²Œì„ ì¢…ë£Œ í™”ë©´ ìˆ¨ê¹€
            $('#pot-box').css('display', 'none');   // íŒŸ ê¸ˆì•¡ í‘œì‹œ ìˆ¨ê¹€
            initText();  // ê¸°ì¡´ ì¹´ë“œ ë° UI ì´ˆê¸°í™”

            // ë°©ì¥ì´ë©´ ê²Œì„ ì‹œì‘ ë²„íŠ¼ ë‹¤ì‹œ ë³´ì´ê²Œ í•¨
            if (userList && userList.length > 0 && userList[0].id === myId) {
                $("#game_start_btn").css('display', 'inline-block');
            }

            if (!joinRoomId) {
                console.error("ê²Œì„ì„ ë‹¤ì‹œ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. joinRoomIdê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ");
                alert("ERROR: ë‹¤ì‹œ ì‹œì‘í•  ë°© ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // ì„œë²„ì— "ê²Œì„ ë‹¤ì‹œ ì‹œì‘" ìš”ì²­ ë³´ë‚´ê¸°
            socket.emit("game_restart", { id: joinRoomId });

            console.log("ê²Œì„ ë‹¤ì‹œ ì‹œì‘ ìš”ì²­ ì „ì†¡ ì™„ë£Œ: ë°© ID =", joinRoomId);
        }


    </script>
    <!-- ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ì‚½ì…í•  ìë¦¬ -->
    <script id="server-data"></script>

    <script>
        // ì„œë²„ì—ì„œ ì‚½ì…ëœ ë°ì´í„°ë¥¼ ë°”ë¡œ ì‚¬ìš©
        // document.getElementById('player-info').textContent = playerName;
        // document.getElementById('player-bet').textContent =  playerBet       
    </script>
    <script>
        // í´ë¦­ ì‹œ ì ‘ì† ë²„íŠ¼ì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ë„ë¡ ë³€ê²½
        const updateRoomList = (rooms) => {
            const roomListDiv = document.getElementById('room_list');
            roomListDiv.innerHTML = '';

            rooms.forEach(room => {
                const roomDiv = document.createElement('div');
                roomDiv.style.padding = '8px 0';
                roomDiv.style.fontSize = '18px';
                roomDiv.style.cursor = 'pointer';

                roomDiv.innerHTML = `ë°© ì´ë¦„: <b>${room.roomId}</b> (ì¸ì›: ${room.userCount}/5)`;

                if (room.userCount < 5) {
                    roomDiv.onclick = () => {
                        if (joinRoomId != null) {
                            alert('ì´ë¯¸ ì…ì¥í•œ ë°©ì´ ìˆìŠµë‹ˆë‹¤: ' + joinRoomId);
                            return;
                        }
                        const roomId = room.roomId;
                        console.log("ENTERED ROOM ID : " + roomId);
                        joinRoomId = roomId;

                        // ê¸°ì¡´ ì ‘ì† ë²„íŠ¼ê³¼ ë™ì¼í•œ ë™ì‘ ìˆ˜í–‰
                        $("#z-call").css('display', 'none');
                        socket.emit("room_join", { id: roomId });
                    };
                    roomDiv.onmouseover = () => roomDiv.style.color = '#00ff00';
                    roomDiv.onmouseout = () => roomDiv.style.color = 'white';
                } else {
                    roomDiv.style.color = '#ff0000';
                    roomDiv.style.cursor = 'default';
                    roomDiv.innerHTML += ' (ì…ì¥ ë¶ˆê°€)';
                }

                roomListDiv.appendChild(roomDiv);
            });
        };

        // ì„œë²„ë¡œë¶€í„° ë£¸ ëª©ë¡ ìˆ˜ì‹ 
        socket.on('room_list', ({ rooms }) => {
            updateRoomList(rooms);
        });

        // ë£¸ ëª©ë¡ ìš”ì²­ (í˜ì´ì§€ ë¡œë“œ ì‹œ ë° ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸)
        socket.emit('get_room_list');
        setInterval(() => {
            socket.emit('get_room_list');
        }, 5000); // 5ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸

        document.getElementById("room_leave_btn_main").addEventListener("click", function () {
            if (joinRoomId == null) {
                alert('ì…ì¥ ì¤‘ì¸ ë°©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            console.log("ë°© ë‚˜ê°€ê¸° ìš”ì²­: " + joinRoomId);

            socket.emit("room_leave", { id: joinRoomId });

            joinRoomId = null;

            // UI ì´ˆê¸°í™”
            document.getElementById("z-call").style.display = "block";  // ë©”ì¸ í™”ë©´ í‘œì‹œ
            document.getElementById("room_buttons").style.display = "none"; // ë‚˜ê°€ê¸° ë²„íŠ¼ ìˆ¨ê¹€
        });

        socket.on("choice", ({ myMoney }) => {
            $('#my-money').html(`${myMoney}ëƒ¥`);
        });

        socket.on("gameover", ({ userMoney }) => {
            $('#my-money').html(`${userMoney[myId]}ëƒ¥`);
        });




    </script>

</body>

</html>